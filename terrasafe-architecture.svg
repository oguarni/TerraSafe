<svg viewBox="0 0 900 700" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="450" y="30" text-anchor="middle" font-size="22" font-weight="bold" fill="#1a1a1a">
    TerraSafe - DevSecOps Security Scanner Architecture
  </text>
  
  <!-- Layer Labels -->
  <text x="20" y="80" font-size="14" font-weight="bold" fill="#666">Input Layer</text>
  <text x="20" y="220" font-size="14" font-weight="bold" fill="#666">Processing Layer</text>
  <text x="20" y="450" font-size="14" font-weight="bold" fill="#666">Output Layer</text>
  
  <!-- Input Layer -->
  <rect x="100" y="60" width="180" height="80" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="8"/>
  <text x="190" y="90" text-anchor="middle" font-size="16" font-weight="bold" fill="#1976d2">Terraform Files</text>
  <text x="190" y="110" text-anchor="middle" font-size="12" fill="#555">Infrastructure as Code</text>
  <text x="190" y="128" text-anchor="middle" font-size="11" fill="#777">(.tf / HCL2 format)</text>
  
  <!-- HCL Parser -->
  <rect x="340" y="70" width="160" height="60" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2" rx="8"/>
  <text x="420" y="95" text-anchor="middle" font-size="14" font-weight="bold" fill="#7b1fa2">HCL Parser</text>
  <text x="420" y="115" text-anchor="middle" font-size="11" fill="#666">python-hcl2</text>
  
  <!-- Feature Extraction -->
  <rect x="560" y="70" width="180" height="60" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="8"/>
  <text x="650" y="95" text-anchor="middle" font-size="14" font-weight="bold" fill="#f57c00">Feature Extraction</text>
  <text x="650" y="115" text-anchor="middle" font-size="11" fill="#666">Vector Generation</text>
  
  <!-- Arrows Input Layer -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#555"/>
    </marker>
  </defs>
  <path d="M 280 100 L 340 100" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
  <path d="M 500 100 L 560 100" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Processing Layer - Rule Engine -->
  <g id="rule-engine">
    <rect x="120" y="200" width="280" height="180" fill="#e8f5e9" stroke="#4caf50" stroke-width="3" rx="10"/>
    <text x="260" y="230" text-anchor="middle" font-size="18" font-weight="bold" fill="#2e7d32">
      Rule Engine (60%)
    </text>
    <text x="260" y="250" text-anchor="middle" font-size="12" fill="#666">Deterministic Detection</text>
    
    <g transform="translate(130, 265)">
      <text y="0" font-size="12" fill="#444">âœ“ Security Groups Analysis</text>
      <text y="20" font-size="12" fill="#444">âœ“ Hardcoded Secrets (Regex)</text>
      <text y="40" font-size="12" fill="#444">âœ“ Encryption Validation</text>
      <text y="60" font-size="12" fill="#444">âœ“ Public Access Detection</text>
      <text y="80" font-size="12" fill="#444">âœ“ Known CVE Patterns</text>
    </g>
  </g>
  
  <!-- Processing Layer - ML Model -->
  <g id="ml-engine">
    <rect x="480" y="200" width="280" height="180" fill="#fce4ec" stroke="#c2185b" stroke-width="3" rx="10"/>
    <text x="620" y="230" text-anchor="middle" font-size="18" font-weight="bold" fill="#880e4f">
      ML Model (40%)
    </text>
    <text x="620" y="250" text-anchor="middle" font-size="12" fill="#666">Probabilistic Detection</text>
    
    <g transform="translate(490, 265)">
      <text y="0" font-size="12" fill="#444">âš¡ Isolation Forest</text>
      <text y="20" font-size="12" fill="#444">âš¡ Anomaly Detection</text>
      <text y="40" font-size="12" fill="#444">âš¡ Pattern Recognition</text>
      <text y="60" font-size="12" fill="#444">âš¡ Baseline Comparison</text>
      <text y="80" font-size="12" fill="#444">âš¡ Confidence Scoring</text>
    </g>
  </g>
  
  <!-- Arrows to Processing -->
  <path d="M 650 130 L 260 200" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
  <path d="M 650 130 L 620 200" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Score Aggregator -->
  <rect x="300" y="420" width="300" height="100" fill="#fff8e1" stroke="#ffa000" stroke-width="3" rx="10"/>
  <text x="450" y="450" text-anchor="middle" font-size="18" font-weight="bold" fill="#ff6f00">
    Hybrid Risk Aggregator
  </text>
  <text x="450" y="475" text-anchor="middle" font-size="14" fill="#555">
    Final Score = 0.6 Ã— Rules + 0.4 Ã— ML
  </text>
  <text x="450" y="495" text-anchor="middle" font-size="12" fill="#777">
    Confidence: HIGH | MEDIUM | LOW
  </text>
  
  <!-- Arrows to Aggregator -->
  <path d="M 260 380 L 380 420" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
  <path d="M 620 380 L 520 420" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Output Layer -->
  <rect x="150" y="560" width="600" height="110" fill="#f5f5f5" stroke="#424242" stroke-width="3" rx="10"/>
  <text x="450" y="590" text-anchor="middle" font-size="18" font-weight="bold" fill="#212121">
    Security Report Output
  </text>
  
  <g transform="translate(180, 605)">
    <text x="0" y="0" font-size="12" fill="#444">ðŸ“Š Risk Score (0-100)</text>
    <text x="0" y="20" font-size="12" fill="#444">ðŸš¨ Vulnerability List</text>
    <text x="0" y="40" font-size="12" fill="#444">ðŸ“‹ Severity Classification</text>
    
    <text x="300" y="0" font-size="12" fill="#444">ðŸ’¡ Remediation Steps</text>
    <text x="300" y="20" font-size="12" fill="#444">ðŸ“„ JSON + Console</text>
    <text x="300" y="40" font-size="12" fill="#444">âš¡ Performance Metrics</text>
  </g>
  
  <!-- Arrow to Output -->
  <path d="M 450 520 L 450 560" stroke="#555" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Model Persistence (Side Panel) -->
  <rect x="790" y="220" width="100" height="140" fill="#e1f5fe" stroke="#0288d1" stroke-width="2" rx="8"/>
  <text x="840" y="245" text-anchor="middle" font-size="13" font-weight="bold" fill="#01579b">
    Persistence
  </text>
  <g transform="translate(800, 260)">
    <text y="0" font-size="11" fill="#555">ðŸ“¦ Models/</text>
    <text y="18" font-size="10" fill="#666">â€¢ model.pkl</text>
    <text y="33" font-size="10" fill="#666">â€¢ scaler.pkl</text>
    <text y="48" font-size="10" fill="#666">â€¢ metadata</text>
    <text y="68" font-size="10" fill="#777">Joblib</text>
    <text y="83" font-size="10" fill="#777">Scikit-learn</text>
  </g>
  
  <!-- Bidirectional arrow -->
  <path d="M 760 290 L 790 290" stroke="#0288d1" stroke-width="2" stroke-dasharray="4,4"/>
  <path d="M 790 290 L 785 287 L 785 293 Z" fill="#0288d1"/>
  <path d="M 760 290 L 765 287 L 765 293 Z" fill="#0288d1"/>
  
  <!-- Legend -->
  <g transform="translate(100, 685)">
    <text x="0" y="-5" font-size="13" font-weight="bold" fill="#333">Architecture:</text>
    
    <rect x="80" y="-15" width="60" height="14" fill="#e8f5e9" stroke="#4caf50" rx="3"/>
    <text x="145" y="-4" font-size="11" fill="#555">Deterministic</text>
    
    <rect x="230" y="-15" width="60" height="14" fill="#fce4ec" stroke="#c2185b" rx="3"/>
    <text x="295" y="-4" font-size="11" fill="#555">Probabilistic</text>
    
    <rect x="380" y="-15" width="60" height="14" fill="#fff8e1" stroke="#ffa000" rx="3"/>
    <text x="445" y="-4" font-size="11" fill="#555">Hybrid</text>
    
    <rect x="520" y="-15" width="60" height="14" fill="#e1f5fe" stroke="#0288d1" rx="3"/>
    <text x="585" y="-4" font-size="11" fill="#555">Storage</text>
  </g>
</svg>